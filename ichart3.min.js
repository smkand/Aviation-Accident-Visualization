margin={top:30,right:30,bottom:30,left:35},width=800-margin.left-margin.right,height=600-margin.top-margin.bottom,x=d3.scale.ordinal().rangeRoundBands([height,0],.1),y=d3.scale.linear().rangeRound([0,width]),outcomes=["total_fatal_injuries","total_minor_injuries","total_serious_injuries","total_uninjured"],leg_keys=["#d43f3a","#204d74","#d58512","#398439"],color=d3.scale.ordinal().domain(outcomes).range(leg_keys),xAxis=d3.svg.axis().scale(x).orient("left"),yAxis=d3.svg.axis().scale(y).orient("bottom").tickFormat(d3.format("s")),svg=d3.selectAll(".echart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),svg.append("g").attr("class","x axis").attr("transform","translate(60,0)").call(xAxis),d3.csv("data/broad_phase_of_flight_outcomes.csv",function(t,a){var r;a.forEach(function(t){var a;return a=0,t.outcomes=color.domain().map(function(r){return{type:t.broad_phase_of_flight,name:r,y0:a,y1:a+=+t[r]}}),t.total=t.outcomes[t.outcomes.length-1].y1}),a.sort(function(t,a){return t.total-a.total}),x.domain(a.map(function(t){return t.broad_phase_of_flight})),y.domain([0,3800]),svg.append("g").attr("class","x axis").attr("transform","translate(60,0)").call(xAxis),svg.append("g").attr("class","y axis").attr("transform","translate(60,"+height+")").call(yAxis),svg.append("text").attr("x",width/2).attr("y",0-margin.top/4).attr("text-anchor","middle").style("font-size","14px").text("Passenger Outcome by Flight Phase"),r=svg.selectAll(".echart").data(a).enter().append("g").attr("class","g").attr("transform",function(t){return"translate(0, "+x(t.broad_phase_of_flight)+")"}),r.selectAll("rect").data(function(t){return t.outcomes}).enter().append("rect").attr("transform",function(t){var a;return a=60+y(t.y0),"translate("+a+",0)"}).attr("width",function(t){return y(t.y1)-y(t.y0)}).attr("height",x.rangeBand()).style("fill",function(t){return color(t.name)}).attr("data-title",function(t){return t.name+": "+t.y1}),$("rect").tooltip({container:"body",html:!0,placement:"top"})});
