function monthPath(t){var e=new Date(t.getFullYear(),t.getMonth()+1,0),a=+day(t),n=+week(t),r=+day(e),l=+week(e);return"M"+(n+1)*cellSize+","+a*cellSize+"H"+n*cellSize+"V"+7*cellSize+"H"+l*cellSize+"V"+(r+1)*cellSize+"H"+(l+1)*cellSize+"V0H"+(n+1)*cellSize+"Z"}var width=900,height=105,cellSize=12;week_days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var day=d3.time.format("%w"),week=d3.time.format("%U"),percent=d3.format(".1%"),format=d3.time.format("%x");parseDate=d3.time.format("%x").parse;var color=d3.scale.category20(),svg=d3.select(".calender-map").selectAll("svg").data(d3.range(1974,1991)).enter().append("svg").attr("width","100%").attr("data-height","0.5678").attr("viewBox","0 0 900 105").attr("class","RdYlGn").append("g").attr("transform","translate("+(width-53*cellSize)/2+","+(height-7*cellSize-1)+")");svg.append("text").attr("transform","translate(-38,"+3.5*cellSize+")rotate(-90)").style("text-anchor","middle").text(function(t){return t});for(var i=0;7>i;i++)svg.append("text").attr("transform","translate(-5,"+cellSize*(i+1)+")").style("text-anchor","end").attr("dy","-.25em").text(function(t){return week_days[i]});var rect=svg.selectAll(".day").data(function(t){return d3.time.days(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("rect").attr("class","day").attr("width",cellSize).attr("height",cellSize).attr("x",function(t){return week(t)*cellSize}).attr("y",function(t){return day(t)*cellSize}).attr("fill","#fff").datum(format),legend=svg.selectAll(".legend").data(month).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate("+(50*(e+1)+8)+",0)"});legend.append("text").attr("class",function(t,e){return month[e]}).style("text-anchor","end").attr("dy","-.25em").text(function(t,e){return month[e]}),svg.selectAll(".month").data(function(t){return d3.time.months(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("path").attr("class","month").attr("id",function(t,e){return month[e]}).attr("d",monthPath),d3.json("data/data_processed.json",function(t,e){var a=d3.nest().key(function(t){return t.event_date}).map(e);rect.filter(function(t){return t in a}).attr("fill",function(t){return color(100*a[t].length)}).attr("data-title",function(t){return t+" number of incidents : "+Math.round(a[t].length)}),$("rect").tooltip({container:"body",html:!0,placement:"top"})});
